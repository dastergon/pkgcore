# Copyright: 2014 Tim Harder <radhermit@gmail.com>
# license GPL2/BSD 3

source "${PKGCORE_BIN_PATH}"/eapi/5.lib

INTERNAL_FUNCS+=( get_libdir )

get_libdir() {
	local CONF_LIBDIR="lib"
	local LIBDIR_VAR="LIBDIR_${ABI}"
	[[ -n ${ABI} && -n ${!LIBDIR_VAR} ]] && CONF_LIBDIR=${!LIBDIR_VAR}
	echo "${CONF_LIBDIR}"
}

einstalldocs() {
	:
}

eapply() {
	:
}

eapply_user() {
	local patchdir=${ROOT:-/}etc/portage/patches

	# patch locations:
	#   - ${CATEGORY}/${P}-${PR}(:${SLOT})
	#   - ${CATEGORY}/${P}(:${SLOT})
	#   - ${CATEGORY}/${PN}(:${SLOT})
	# currently "hidden" patch files starting with a '.' aren't applied
	__shopt_push -s nullglob
	local patches=( "${patchdir}"/${CATEGORY}/{${P}-${PR},${P},${PN}}{,:${SLOT%/*}}/* )
	__shopt_pop

	if [[ -n ${patches[@]} ]]; then
		einfo "Applying user patches ..."
		eapply "${patches[@]}"
	fi
}

__phase_eapi6_src_prepare() {
	local var
	if var=$(declare -p PATCHES 2> /dev/null); then
		if [[ ${var} == "declare -a "* ]]; then
			eapply "${PATCHES[@]}"
		else
			eapply ${PATCHES}
		fi
	fi

	eapply_user
}

default_src_prepare() { __phase_eapi6_src_prepare; }

:
